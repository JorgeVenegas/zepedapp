<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solution Generation API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 10px 0; }
        button:hover { background: #0056b3; }
        .loading { color: #666; font-style: italic; }
        .error { color: #d32f2f; background: #ffebee; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { color: #2e7d32; background: #e8f5e9; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .solution { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 4px; background: #fafafa; }
        .solution-header { font-weight: bold; color: #333; margin-bottom: 10px; }
        .tags { margin: 10px 0; }
        .tag { background: #e3f2fd; color: #1976d2; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px; }
        .stats { background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; }
        textarea { width: 100%; height: 200px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Solution Generation API Test</h1>
        
        <div>
            <h3>Pattern Input:</h3>
            <textarea id="patternInput">{
  "pattern": {
    "id": "test-browser-1",
    "title": "High Memory Usage Alerts",
    "description": "Frequent high memory usage alerts across multiple microservices causing performance degradation and user complaints",
    "priority": 7,
    "frequency": 8,
    "time_range": {
      "start": "2024-11-01T00:00:00Z",
      "end": "2024-11-22T00:00:00Z"
    },
    "filters": {
      "services": ["api-service", "worker-service", "cache-service"],
      "categories": ["performance", "infrastructure"],
      "keywords": ["memory", "performance", "alerts"]
    }
  },
  "options": {
    "maxSolutions": 4,
    "feasibilityThreshold": 6,
    "prioritizeBy": "feasibility"
  }
}</textarea>
        </div>
        
        <button onclick="testAPI()">Generate Solutions</button>
        <button onclick="testWithDifferentPattern()">Test Different Pattern</button>
        
        <div id="output"></div>
    </div>

    <script>
        async function testAPI() {
            const output = document.getElementById('output');
            const input = document.getElementById('patternInput').value;
            
            output.innerHTML = '<div class="loading">üîÑ Generating solutions...</div>';
            
            try {
                const data = JSON.parse(input);
                
                const response = await fetch('/api/solutions/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displaySolutions(result.solutions);
                } else {
                    output.innerHTML = `<div class="error">‚ùå Error: ${result.error}</div>`;
                }
            } catch (error) {
                output.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function displaySolutions(solutions) {
            const stats = calculateStats(solutions);
            
            let html = `<div class="success">‚úÖ Generated ${solutions.length} solutions</div>`;
            
            html += `<div class="stats">
                <h4>üìä Statistics:</h4>
                <p><strong>Average Feasibility:</strong> ${stats.avgFeasibility}/10</p>
                <p><strong>Average Cost:</strong> $${stats.avgCost.toLocaleString()}</p>
                <p><strong>Average Timeline:</strong> ${stats.avgDays} days</p>
                <p><strong>Impact Distribution:</strong> High: ${stats.impactDist.High}, Medium: ${stats.impactDist.Medium}, Low: ${stats.impactDist.Low}</p>
            </div>`;
            
            solutions.forEach((solution, index) => {
                html += `
                    <div class="solution">
                        <div class="solution-header">${index + 1}. ${solution.name}</div>
                        <p><strong>üí∞ Cost:</strong> $${solution.cost.min.toLocaleString()} - $${solution.cost.max.toLocaleString()}</p>
                        <p><strong>üéØ Feasibility:</strong> ${solution.feasibility}/10</p>
                        <p><strong>‚è±Ô∏è Timeline:</strong> ${solution.implementationTime.estimatedDays} days</p>
                        <p><strong>üìà Impact:</strong> ${solution.impact}</p>
                        <p><strong>üìù Description:</strong> ${solution.description}</p>
                        <div class="tags">
                            <strong>üè∑Ô∏è Tags:</strong> 
                            ${solution.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        ${solution.reasoning ? `<p><strong>ü§ñ AI Reasoning:</strong> ${solution.reasoning}</p>` : ''}
                    </div>
                `;
            });
            
            document.getElementById('output').innerHTML = html;
        }
        
        function calculateStats(solutions) {
            const avgFeasibility = solutions.reduce((sum, s) => sum + s.feasibility, 0) / solutions.length;
            const avgCost = solutions.reduce((sum, s) => sum + (s.cost.min + s.cost.max) / 2, 0) / solutions.length;
            const avgDays = solutions.reduce((sum, s) => sum + s.implementationTime.estimatedDays, 0) / solutions.length;
            
            const impactDist = solutions.reduce((dist, s) => {
                dist[s.impact]++;
                return dist;
            }, { High: 0, Medium: 0, Low: 0 });
            
            return {
                avgFeasibility: Math.round(avgFeasibility * 10) / 10,
                avgCost: Math.round(avgCost),
                avgDays: Math.round(avgDays),
                impactDist
            };
        }
        
        function testWithDifferentPattern() {
            document.getElementById('patternInput').value = JSON.stringify({
                "pattern": {
                    "id": "test-browser-2",
                    "title": "API Response Time Degradation",
                    "description": "Users experiencing slow API response times leading to poor user experience and increased complaints",
                    "priority": 8,
                    "frequency": 12,
                    "time_range": {
                        "start": "2024-11-15T00:00:00Z",
                        "end": "2024-11-22T00:00:00Z"
                    },
                    "filters": {
                        "services": ["api-gateway", "database-service"],
                        "categories": ["performance", "user-experience"],
                        "keywords": ["slow", "response", "api", "performance"]
                    }
                },
                "options": {
                    "maxSolutions": 3,
                    "feasibilityThreshold": 7,
                    "budgetLimit": 15000,
                    "prioritizeBy": "impact"
                }
            }, null, 2);
        }
    </script>
</body>
</html>
